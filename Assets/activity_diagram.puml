@startuml BloodHero Activity Diagram - User Registration to Donation

start

:Open App;

if (User has account?) then (yes)
  :Enter credentials;
  :Login via LoginActivity;
  :UserRepository.getUserByEmail();
  :Save to UserHelper.saveCurrentUser();
else (no)
  :Click Register;
  :Enter email and password;
  :Submit registration;
  if (Valid credentials?) then (no)
    :Show error message;
    stop
  else (yes)
    :UserRepository.createUser();
    :Insert into SQLite users table;
  endif
  
  :Navigate to profile setup;
  :Enter name, blood type, location;
  :UserRepository.updateUser();
  :Save profile to SQLite;
  :Unlock "Profile Complete" badge;
endif

:Navigate to Home Dashboard;
:UserHelper.getCurrentUser();
:Display stats from SQLite;

:Click "Find Campaigns";
:CampaignsActivity loads campaigns;
:Display campaign list;

if (Campaigns available?) then (no)
  :Show "No campaigns found";
  stop
else (yes)
  :Display campaign list;
endif

:Select campaign;
:View campaign details;
:Click "Book Appointment";
:Choose date and time;

if (Slot available?) then (no)
  :Show unavailable message;
  stop
else (yes)
  :Confirm booking;
  partition "Appointment Booking" {
    :Create Appointment object;
    :AppointmentRepository.createAppointment();
    :INSERT INTO appointments table;
    :Status = SCHEDULED;
  }
  :Display confirmation;
  :Navigate to MyAppointmentsActivity;
endif

:View appointment in MyAppointments;
:AppointmentRepository.getAppointmentsByUserId();

note right
  Donor arrives at donation center
  with QR code displayed in app
end note

partition "Admin Check-In Process" {
  :Admin opens QRScannerActivity;
  :Admin scans donor's QR code;
  :AppointmentRepository.updateStatus(CHECKED_IN);
  :Set checkedInAt timestamp;
  :LocalBroadcastManager.sendBroadcast();
  :Donor's app updates to CHECKED_IN;
}

partition "Bed Assignment" {
  :Admin opens BedManagementActivity;
  :Admin assigns donor to available bed;
  :AppointmentRepository.assignToBed(bedNumber);
  :Status = CHECKED_IN;
}

note right
  Donor completes blood donation
  (Physical donation happens)
end note

partition "Donation Completion" {
  :Admin generates verification code;
  :AppointmentRepository.setPendingVerification(code);
  :Status = PENDING_VERIFICATION;
  :Donor enters verification code in app;
  :App validates code;
  :DonationRepository.saveDonation();
  :UserRepository.incrementDonations(+50 points);
  :Status = COMPLETED;
  :All saved to SQLite database;
  :LocalBroadcastManager syncs UI;
  :Admin releases bed;
}

:User opens app;
:Appointment status = COMPLETED;
:Donation appears in DonationHistoryActivity;
:Points automatically updated;
:Leaderboard rank updated;
:Check for unlocked badges;

if (First donation?) then (yes)
  :Unlock "First Drop" badge;
  :Award badge points;
endif

if (5 donations?) then (yes)
  :Unlock "Regular Donor" badge;
endif

note right
  All data synchronized automatically
  via SQLite - single source of truth
  LocalBroadcastManager ensures
  real-time UI updates across activities
  QR scanning + verification codes
  ensure secure donation tracking
end note

stop

@enduml

