    @startuml BloodHero Appointment Booking & Admin Approval - SQLite Architecture

    /' Donor Booking Flow '/
    actor "Donor" as donor
    participant "CampaignsActivity" as ui
    participant "AppointmentRepository" as appointmentRepo
    participant "UserHelper" as helper
    participant "BloodHeroDatabaseHelper" as db
    participant "SQLiteDatabase" as sqlite

    == User Opens Campaigns ==
    donor -> ui : Opens Campaigns screen
    ui -> helper : getCurrentUser(context)
    helper --> ui : currentUser
    ui -> ui : loadAllCampaigns()
    ui --> donor : Display campaign list

    == User Selects Campaign ==
    donor -> ui : Clicks on campaign
    ui --> donor : Show campaign details

    == User Books Appointment ==
    donor -> ui : Clicks "Book Now"
    ui -> ui : showBookingDialog(campaign)
    donor -> ui : Confirms booking

    ui -> ui : Create Appointment object
    note right
    new Appointment(
        UUID.randomUUID(),
        currentUser.getId(),
        campaign.getId(),
        campaign.getName(),
        campaign.getLocation(),
        date, time,
        Status.SCHEDULED
    )
    end note

    ui -> appointmentRepo : createAppointment(appointment)
    appointmentRepo -> db : insertAppointment(appointment)
    db -> sqlite : INSERT INTO appointments VALUES(...)
    sqlite --> db : rowId
    db --> appointmentRepo : success
    appointmentRepo --> ui : true

    ui --> donor : "Appointment booked successfully!"
    ui -> ui : Navigate to MyAppointmentsActivity

    newpage Admin Approval Flow

    actor "Admin" as admin
    participant "AdminAppointmentsActivity" as adminUI
    participant "AppointmentRepository" as apptRepo
    participant "DonationRepository" as donationRepo
    participant "UserRepository" as userRepo
    participant "BloodHeroDatabaseHelper" as dbHelper
    participant "SQLiteDatabase" as db

    == Admin Views Appointments ==
    admin -> adminUI : Opens Admin Appointments
    adminUI -> apptRepo : getAllAppointments()
    apptRepo -> dbHelper : getAllAppointments()
    dbHelper -> db : SELECT * FROM appointments
    db --> dbHelper : Cursor
    dbHelper --> apptRepo : List<Appointment>
    apptRepo --> adminUI : appointments

    loop For each appointment
    adminUI -> userRepo : getUserById(userId)
    userRepo -> dbHelper : getUserById(id)
    dbHelper -> db : SELECT * FROM users WHERE id=?
    db --> dbHelper : User data
    dbHelper --> userRepo : User
    userRepo --> adminUI : user
    end

    adminUI --> admin : Display appointments with user details

    == Admin Marks Donation Complete ==
    admin -> adminUI : Clicks "Mark Completed"
    adminUI -> adminUI : markAsCompleted(appointment)

    adminUI -> apptRepo : updateStatus(appointmentId, COMPLETED)
    apptRepo -> dbHelper : updateAppointmentStatus(id, COMPLETED)
    dbHelper -> db : UPDATE appointments SET status='COMPLETED'
    db --> dbHelper : rowsAffected
    dbHelper --> apptRepo : success
    apptRepo --> adminUI : true

    adminUI -> userRepo : getUserById(userId)
    userRepo --> adminUI : user

    adminUI -> adminUI : Create Donation object
    note right
    new Donation(
        UUID.randomUUID(),
        user.getId(),
        campaignId,
        location,
        date,
        bloodType,
        50, // points
        "COMPLETED"
    )
    end note

    adminUI -> donationRepo : saveDonation(donation)
    donationRepo -> dbHelper : insertDonation(donation)
    dbHelper -> db : INSERT INTO donations VALUES(...)
    db --> dbHelper : rowId
    dbHelper --> donationRepo : success
    donationRepo --> adminUI : true

    adminUI -> userRepo : incrementDonations(userId, 50)
    userRepo -> dbHelper : incrementDonations(id, 50)
    dbHelper -> db : UPDATE users SET points=points+50,\ntotalDonations=totalDonations+1
    db --> dbHelper : rowsAffected
    dbHelper --> userRepo : success
    userRepo --> adminUI : void

    adminUI --> admin : "Donation recorded! User earned 50 points"

    note over donor, db
    Now when donor opens app:
    - Appointment status = COMPLETED
    - Donation appears in history
    - Points automatically updated
    - All data synchronized via SQLite
    end note

    @enduml